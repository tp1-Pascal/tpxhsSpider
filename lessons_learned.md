# 小红书自动化抓取项目经验沉淀 (Phase 1-3)

本文件记录了在开发“小红书多关键词自动抓取工具”过程中，针对其反爬机制所取得的关键突破和实战经验。

## 核心突破：规避反爬检测

### 1. 滚动加载 (Scrolling)
**失败经验**：直接调用 JavaScript 原生方法（如 `window.scrollTo`）会被小红书的脚本精准识别并引发无法滚动或触发验证码。
**成功经验**：**硬件级模拟滚动**。
- **推荐方法**：`browser_mouse_wheel` (模拟真实鼠标滚轮)。
- **备选方法**：键盘按键模拟（`PageDown`、`Space`、`ArrowDown`、`End`）。
- **技术要点**：物理按键事件不会触发小红书针对 JS 滚动的监测钩子。

### 2. 打开详情页 (Opening Links)
**成功经验**：
- **新标签页模式**：使用 `window.open(url, '_blank')` 或通过 JS 创建临时 `<a>` 标签并调用 `.click()`。目前这类操作仍被视为合法的用户意图。
- **站内弹窗模式**：使用 `PointerEvent('click')` 或 `browser_click_pixel` 直接点击。这种方式在当前标签页打开弹窗，无需切换标签，抓取效率更高。

## 实战技巧

### 1. 虚拟列表 (Virtual List) 采集
小红书搜索结果页采用虚拟列表技术（只保留屏幕附近的 DOM 元素）。
- **对策**：在 JS 环境中建立一个**全局 Accumulator (累加器)**。当页面滚动时，实时将新出现的 ID 加入累加器，而不是等到滚动结束后再一次性提取。

### 2. 模拟真人行为 (Human Simulation)
单纯的自动化很容易被标记，必须引入随机性：
- **打字模拟**：搜索框输入关键词时，每个字符间隔随机 100-200ms。
- **随机偏移**：点击按钮时，对坐标进行 ±5px 的随机抖动。
- **随机延迟**：在每个关键环节（滚动、打开详情、抓取、关闭）之间加入 ±30% 浮动的随机等待时间。

### 3. 图片抓取
- **高质量源**：小红书图片 URL 通常包含签名和参数。在详情页中寻找最清晰的节点进行采集。
- **多样性**：支持图文笔记（首图）和视频笔记（封面图）的自动识别与下载。

## 阶段性结论
目前的测试证明：**物理硬件事件驱动 + JS 逻辑注入** 是突破小红书当前防御的最有效组合。

---
*更新日期：2026-01-25*
*对应阶段：Phase 3 结束，准备进入 Phase 4*
